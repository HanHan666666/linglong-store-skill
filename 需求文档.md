
# AI 应用商店 Agent Skill 需求文档

## 相关的重要文档
API交互细节见GUI版的商店，读取目录：/home/han/linglong-store/rust-linglong-store
后端接口文档见 "API 文档" 这个tool
ll-cli相关的操作文档：/home/han/linglong-store/rust-linglong-store/linglong-docs


## 1. 背景与目标

本需求用于建设一个 AI 版应用商店的 agent skill，让 AI 助手能够完成应用搜索、查看详情、安装应用以及检查/执行更新。能力基于两类数据源：

- ll-cli 使用说明（安装、搜索、升级）
- 商店后端 API（分类、应用列表、搜索、详情、更新检查）

## 2. 适用范围

- 目标系统：支持 ll-cli 的 Linux 桌面系统。
- 目标用户：希望通过自然语言完成应用安装与更新的用户。

## 3. 功能范围

### 3.1 搜索与发现

- 通过后端 API 获取分类列表、分类下应用列表、搜索结果列表。
- 支持按关键词、分类、架构、语言、分页等条件查询。
- 支持查看应用详情（图标、描述、版本、架构、大小、运行时等）。
- 在线应用列表与搜索必须使用 Web API，不使用 ll-cli search。

### 3.2 安装应用

- 当用户输入应用名或关键词，先使用搜索接口获得候选结果。
- 用户确认 appId 后，调用 ll-cli 安装。
- 支持安装指定版本、指定模块、指定仓库、指定架构。
- 支持通过本地 .uab / .layer 文件安装。
- 安装完成后需要上报安装统计记录。
- 卸载完成后需要上报卸载统计记录。

### 3.3 更新应用

- 检查更新：上传本机已安装应用列表至后端更新检查接口，返回可更新的应用。
- 执行更新：使用 ll-cli upgrade 更新单个或全部应用。

### 3.4 反馈

- 支持用户提交意见反馈并上报到后端。

## 4. 数据与接口需求

### 4.0 接口调用约束

- 所有后端接口请求尽量使用 curl 实现，保证 0 依赖。
- 在线应用列表与搜索统一使用 Web API，不使用 ll-cli search。

### 4.1 分类与应用列表

- 获取分类列表（Web 侧）
	- GET /web/categories
	- Query: lang, arch
	- 返回：分类列表（categoryId, categoryName, icon, categoryCount）

- 获取分类列表（App 侧）
	- GET /visit/getDisCategoryList
	- 返回：分类列表（categoryId, categoryName, icon, count）

- 获取分类下应用数量
	- GET /web/getCategoryAppCount
	- Query: categoryId
	- 返回：分类下应用数量

- 按条件获取应用列表（搜索/分类/分页）
	- POST /visit/getSearchAppList
	- Body: AppMainVO
	- 关键字段：pageNo, pageSize, appId, name, zhName, categoryId, arch, module, version, sort, order, lan
	- 返回：分页应用列表（包含 appId, name, description, version, arch, repoName 等）

- 获取应用不同版本列表
	- POST /visit/getSearchAppVersionList
	- Body: AppMainVO（使用 appId 过滤）
	- 返回：版本列表

### 4.2 应用详情

- 获取应用详情（新版）
	- POST /app/getAppDetail
	- Body: AppDetailSearchBO[]
	- 关键字段：appId, arch, lang
	- 返回：详情列表（含截图、标签、描述）

- 获取应用详情（兼容接口）
	- POST /visit/getAppDetails
	- Body: AppDetailsVO[]
	- 关键字段：appId, version, channel, module, arch

### 4.3 更新检查

- 检查更新
	- POST /app/appCheckUpdate
	- Body: AppCheckVersionBO[]
	- 关键字段：appId, arch, version
	- 返回：存在更新的应用详情列表

### 4.4 安装/卸载统计记录上报

- 安装/卸载统计记录上报（GUI 商店已有逻辑，需保持一致）
	- POST /app/saveInstalledRecord
	- 备注：安装和卸载完成后都应调用，字段与 GUI 商店一致

- 访问记录（可选）
	- POST /app/saveVisitRecord
	- 备注：用户查看详情或打开商店时上报

### 4.5 意见反馈

- Web 反馈接口
	- POST /web/suggest

- App 侧反馈接口（可选）
	- POST /visit/suggest

## 5. ll-cli 命令约束

### 5.1 安装

- 基本安装
	- ll-cli install <appid>
- 指定版本
	- ll-cli install <appid/version>
- 指定模块
	- ll-cli install <appid> --module=<module>
- 指定仓库
	- ll-cli install <appid> --repo=<repo>
- 强制指定版本
	- ll-cli install <appid> --force
- 自动确认
	- ll-cli install <appid> -y
- 文件安装
	- ll-cli install <path>.uab
	- ll-cli install <path>.layer

### 5.2 搜索

- 禁用本地搜索
	- ll-cli search 不用于在线应用搜索与列表展示
	- 在线搜索与列表必须通过 Web API

### 5.3 升级

- 升级所有可升级应用
	- ll-cli upgrade
- 升级单个应用
	- ll-cli upgrade <appid>

## 6. 交互与流程要求

### 6.1 搜索与安装流程

1. 用户输入应用名称或关键词。
2. 调用 /visit/getSearchAppList 获取候选列表。
3. 展示候选结果（名称、appId、版本、架构、描述）。
4. 用户确认 appId / 版本 / 模块 / 架构。
5. 使用 ll-cli install 执行安装。
6. 输出安装结果或失败原因。

### 6.2 更新流程

1. 收集本机已安装应用列表（通过 ll-cli list 或其他来源）。
2. 调用 /app/appCheckUpdate，返回可更新应用。
3. 用户选择更新全部或指定应用。
4. 使用 ll-cli upgrade 执行更新。
5. 输出更新结果。

### 6.3 安装/卸载统计上报流程

1. 完成安装或卸载操作。
2. 读取必要的 appId、版本、架构、渠道等字段。
3. 调用 /app/saveInstalledRecord 上报统计记录。
4. 记录接口返回结果，失败时可重试或告警。

### 6.4 反馈流程

1. 用户输入反馈内容。
2. 调用 /web/suggest 或 /visit/suggest 上报。
3. 返回提交结果。

## 7. 错误处理与提示

- 搜索无结果：提示可用的搜索词或建议更改关键词。
- 多版本或多架构冲突：要求用户选择版本与架构。
- 安装失败：返回 ll-cli 输出的错误摘要并提示重试， 去rust的GUI商店找错误吗，写到skill里面。
- 更新检查接口失败：可退化为 ll-cli upgrade 提示用户手动更新。

## 8. 非功能性要求

- 可靠性：API 与 ll-cli 任一失败时可给出备用方案。
- 可观测性：记录搜索与安装操作的关键参数与结果。
- 兼容性：默认支持 x86_64，同时允许用户指定 arch。

## 9. 产出物

- 需求文档（本文件）
- skill 规格说明（技能功能、API 使用、命令映射）
- 交互流程示例与异常处理示例

## 10. 确认事项

- 后端 API 的 base URL 是 https://storeapi.linyaps.org.cn/ 无需认证
- ll-cli 允许在当前运行环境直接调用并获取已安装应用列表。
- 不需要支持多仓库或私有仓库。

## 11. 交互示例（用户对话脚本）

### 11.1 搜索并安装

用户：帮我安装 WPS。
助手：正在搜索在线应用……
助手：找到 2 个结果：
1) WPS Office - appId: cn.wps.wps-office - 版本: 11.1.0.10161 - 架构: x86_64
2) WPS Office Beta - appId: cn.wps.wps-office.beta - 版本: 11.1.0.10170 - 架构: x86_64
助手：请选择要安装的应用编号。
用户：1
助手：已确认 appId：cn.wps.wps-office，开始安装。
助手：安装完成。是否需要打开应用？

### 11.2 检查更新并升级

用户：检查一下更新。
助手：正在检查可更新应用……
助手：发现 1 个可更新应用：org.deepin.calculator (5.7.21.3 -> 5.7.21.4)
助手：需要升级吗？
用户：升级
助手：正在升级……
助手：升级完成，请重启应用体验新版本。

### 11.3 反馈问题

用户：反馈一个问题，商店首页加载很慢。
助手：已记录反馈内容："商店首页加载很慢"。正在提交……
助手：提交成功，感谢反馈。
